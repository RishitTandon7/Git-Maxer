name: ü§ñ GitMaxer Auto Commit Bot

on:
  # DISABLED: Run every 15 minutes (causing too many commits)
  # Uncomment below if you want every-15-min execution:
  # schedule:
  #   - cron: '*/15 * * * *'  # Every 15 minutes
  
  # Run once daily at midnight IST (18:30 UTC)
  schedule:
    - cron: '30 18 * * *'  # Once per day at 12 AM IST
  
  # Allow manual triggering from GitHub UI
  workflow_dispatch:
  
  # Trigger from external webhook (for testing)
  repository_dispatch:
    types: [trigger-bot]

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: üöÄ Trigger Vercel Cron Endpoint
        run: |
          echo "ü§ñ Triggering GitMaxer bot at $(date)"
          
          # Call your Vercel API endpoint
          response=$(curl -X GET \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "User-Agent: github-actions-cron" \
            -w "\n%{http_code}" \
            -s \
            "${{ secrets.VERCEL_CRON_URL }}")
          
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')
          
          echo "üìä Response Code: $http_code"
          echo "üìù Response Body: $body"
          
          if [ "$http_code" -ge 200 ] && [ "$http_code" -lt 300 ]; then
            echo "‚úÖ Bot executed successfully!"
          else
            echo "‚ùå Bot execution failed with code $http_code"
            exit 1
          fi
      
      - name: üìä Log Execution
        if: always()
        run: |
          echo "‚è∞ Execution completed at $(date)"
          echo "üåç Timezone: $(date +%Z)"
